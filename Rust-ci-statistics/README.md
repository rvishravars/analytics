# An Empirical Study of Continuous Integration in Open-Source Rust Projects

This project is a collection of Python scripts designed to analyze various aspects of "CI Theater" in open-source Rust projects on GitHub. The scripts fetch data using the GitHub API and by cloning repositories, analyze metrics related to code size, testing, CI/CD usage, and commit patterns, and then generate reports and visualizations.

## Prerequisites

Before you begin, ensure you have the following installed:

*   Python 3.8+
*   Git
*   [cloc](https://github.com/AlDanial/cloc) (This command-line tool is required for the `2-ci-theater-project-size.py` script).

You will also need a GitHub Personal Access Token with `repo` scope to use the GitHub API for data collection.

## Installation

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/your-username/Rust-ci-statistics.git
    cd Rust-ci-statistics
    ```

2.  **Create a virtual environment (recommended):**
    ```bash
    python -m venv venv
    source venv/bin/activate  # On Windows, use `venv\Scripts\activate`
    ```

3.  **Install the required Python packages:**
    This step will install all the necessary libraries listed in `requirements.txt`.
    ```bash
    pip install -r requirements.txt
    ```

4.  **Set up your environment variables:**
    Create a file named `.env` in the root of the project directory and add your GitHub token to it. This keeps your token secure and out of the source code.
    ```
    GITHUB_TOKEN="your_github_personal_access_token_here"
    ```
    The scripts will automatically load this token.

## Execution Workflow

The scripts are designed to be run in a specific order to build upon the data generated by previous steps. The primary workflow below is for answering RQ3 (comparing monoglot vs. polyglot projects).

This document outlines two parallel workflows for classifying projects:
1.  **Default Workflow: By Language Count**: Classifies projects as "monoglot" if they contain only Rust (after filtering non-code languages), and "polyglot" if they contain Rust plus at least one other language.
2.  **Alternative Workflow: By Rust SLOC Percentage**: Classifies projects as "monoglot" if they are 100% Rust, and "polyglot" if Rust constitutes 50-99.9% of the codebase.

Choose one workflow and follow its steps through all phases.

### Default Workflow: Classification by Language Count

This is the original method used for the study.

#### Phase 1: Classify Projects and Create Cohorts

1.  **Prepare Project List**: Ensure your master list of projects is defined in `ci_rust_projects.py`.

2.  **Classify Projects**: Run the script to analyze the language composition of each project. This creates CSVs that categorize projects as monoglot (Rust-only) or polyglot (Rust + other languages).
    ```bash
    python 29_collect_language_sloc.py
    ```

3.  **Generate Cohort Files**: Run the helper script to create Python list files from the CSVs generated in the previous step.
    ```bash
    python helper_create_cohorts.py
    ```
    This will produce `rust_repos_monoglot.py` and `rust_repos_polyglot.py`, which define the two project groups for the next phase. This script uses `data/29_polyglot_rust_repos_summary.csv` and `data/29_monoglot_rust_repos_summary.csv` which are generated by `29_collect_language_sloc.py`.

#### Phase 2: Run Data Collection Scripts for Each Cohort

Run the data collection scripts for each cohort. Each script takes the project list file (without the `.py` extension) and an output CSV path as command-line arguments.

> **Note on `24_1_ci_theater_coverage_rust.py`**: This script is optimized to efficiently search for code coverage artifacts. It filters GitHub Actions artifacts by name (e.g., "coverage", "lcov") *before* downloading them, which avoids consuming time and bandwidth on large, irrelevant build assets.

##### For the Monoglot Cohort

```bash
# Collect Commit Frequency | done
python 20_ci_theater_commit_frequency_rust.py --projects-file rust_repos_monoglot --output-file data/20_commit_freq_monoglot.csv

# Collect Build Durations | done
python 22_ci_theater_long_builds_rust.py --projects-file rust_repos_monoglot --output-file data/22_long_builds_monoglot.csv

# Collect General Project Statistics | done
python 23_github_project_statistics_rust.py --projects-file rust_repos_monoglot --output-file data/23_stats_monoglot.csv

# Collect Test & Coverage Stats | done
python 24_1_ci_theater_coverage_rust.py --projects-file rust_repos_monoglot --output-file data/24_coverage_monoglot.csv

# Collect Broken Build Stats | done
python 28_ci_theater_broken_builds_rust_new.py --projects-file rust_repos_monoglot --output-file data/28_broken_builds_monoglot.csv

# Collect Bug-like Issues | done
python 31_collect_bug_issues.py --projects-file rust_repos_monoglot --stats-file data/23_stats_monoglot.csv --output-file data/31_bugs_monoglot.csv

#### For the Polyglot Cohort

```bash
# Collect Commit Frequency | done
python 20_ci_theater_commit_frequency_rust.py --projects-file rust_repos_polyglot --output-file data/20_commit_freq_polyglot.csv

# Collect Build Durations | done
python 22_ci_theater_long_builds_rust.py --projects-file rust_repos_polyglot --output-file data/22_long_builds_polyglot.csv

# Collect General Project Statistics | done
python 23_github_project_statistics_rust.py --projects-file rust_repos_polyglot --output-file data/23_stats_polyglot.csv

# Collect Test & Coverage Stats | done
python 24_1_ci_theater_coverage_rust.py --projects-file rust_repos_polyglot --output-file data/24_coverage_polyglot.csv

# Collect Broken Build Stats | done
python 28_ci_theater_broken_builds_rust_new.py --projects-file rust_repos_polyglot --output-file data/28_broken_builds_polyglot.csv

# Collect Bug-like Issues | done
python 31_collect_bug_issues.py --projects-file rust_repos_polyglot --stats-file data/23_stats_polyglot.csv --output-file data/31_bugs_polyglot.csv
```

### Phase 3: Generate Comparative Analysis

# Analyse bugs issued by size

python 31_2_ci_bug_issues_by_size_combined.py  \
    --mono-bugs-file data/31_bugs_monoglot.csv   \
    --poly-bugs-file data/31_bugs_polyglot.csv  \
    --output-file figures/bugs_before_after_ci_by_cohort.png   \
    --mono-cohort-name "Monoglot"  \
    --poly-cohort-name "Polyglot"

# Analyze Commit Frequency by Project Size | done
python 21_1_ci_theater_commit_freq_by_project_size_rust.py \
  --mono-freq-file data/20_commit_freq_monoglot.csv \
  --mono-sizes-file data/29_monoglot_rust_repos_summary.csv \
  --poly-freq-file data/20_commit_freq_polyglot.csv \
  --poly-sizes-file data/29_polyglot_rust_repos_summary.csv \
  --output-file figures/commit_freq.png \
  --mono-cohort-name Monoglot \
  --poly-cohort-name Polyglot

# Analyze Time to First CI by Project Size | done
python 25_ci_theater_time_to_ci_by_size_rust.py \
    --mono-stats-file data/23_stats_monoglot.csv \
    --mono-sizes-file data/29_monoglot_rust_repos_summary.csv \
    --mono-cohort-name Monoglot \
    --poly-stats-file data/23_stats_polyglot.csv \
    --poly-sizes-file data/29_polyglot_rust_repos_summary.csv \
    --poly-cohort-name Polyglot \
    --output-file figures/time_to_ci.png

# Analyze Average Build Duration by Project Size done
python 27_ci_theater_long_build_by_project_size_rust.py \
    --mono-builds-file data/22_long_builds_monoglot.csv \
    --mono-sizes-file data/29_monoglot_rust_repos_summary.csv \
    --poly-builds-file data/22_long_builds_polyglot.csv \
    --poly-sizes-file data/29_polyglot_rust_repos_summary.csv \
    --output-file figures/build_duration.png \
    --plot-style default

# Analyze Broken Build Duration by Project Size
python 28_1_ci_theater_broken_builds_by_project_size_rust.py \
    --mono-broken-builds-file data/28_broken_builds_monoglot.csv \
    --mono-sizes-file data/29_monoglot_rust_repos_summary.csv \
    --poly-broken-builds-file data/28_broken_builds_polyglot.csv \
    --poly-sizes-file data/29_polyglot_rust_repos_summary.csv \
    --output-file figures/broken_build_duration.png \
    --mono-cohort-name Monoglot \
    --poly-cohort-name Polyglot

# Analyze CI Test Adoption
python 33.ci_test_adoption_analysis.py \
    --mono-csv data/24_coverage_monoglot.csv \
    --poly-csv data/24_coverage_polyglot.csv \
    --mono-total-csv data/29_monoglot_rust_repos_summary.csv \
    --poly-total-csv data/29_polyglot_rust_repos_summary.csv \
    --output-file figures/ci_test_adoption.png

# Analyze coverage
python 24_2_ci_theater_coverage_rust_analysis.py \
        --mode coverage \
        --mono-input-csv data/24_coverage_monoglot.csv \
        --poly-input-csv data/24_coverage_polyglot.csv \
        --output-file figures/test_coverage.png \
        --mono-cohort-name Monoglot \
        --poly-cohort-name Polyglot

# Analyze commit velocity leading to CI
python 25_1_ci_theater_ci_by_commit_velocity.py \
    --mono-stats-file ./data/23_stats_monoglot.csv \
    --mono-sizes-file ./data/29_monoglot_rust_repos_summary.csv \
    --poly-stats-file ./data/23_stats_polyglot.csv \
    --poly-sizes-file ./data/29_polyglot_rust_repos_summary.csv \
    --output-file ./output/ci_correlation_plot.png
    --recompute N
    --cache-file ./output/computed_data.csv
    --log-y


Run the final comparison script. It reads the CSV files generated in Phase 2 and produces plots and statistical tests comparing the two cohorts.

```bash
# This command uses the default file paths (e.g., data/20_commit_freq_monoglot.csv).
python 32_polyglot_vs_monoglot_comparison.py
```

Results will be saved in the `figures/polyglot_comparison/` directory. Other analysis scripts (e.g., `21_1_...`, `25_...`) can be run to explore the data further, but they may require modifications to read the new cohort-specific CSV files.

## Additional Analysis and Filtering Scripts

Beyond the main workflow for comparing monoglot and polyglot projects, this repository contains several other useful scripts for data filtering and analysis.

### Initial Data Filtering

These scripts can be used to pre-filter the initial list of repositories (`ci_rust_projects.py`) before classification.

*   `rust_repo_with_ci.py`: Checks which repositories have a `.github/workflows` directory and creates a new project list containing only those that use GitHub Actions.
*   `rust_repo_with_ci_no_demos.py`: A more advanced filter that excludes repositories that appear to be demos, tutorials, or templates based on their name, description, topics, and file structure.

### Standalone Analysis Scripts

These scripts perform specific analyses on the generated data.

*   **Polyglot Composition Analysis**:
    ```bash
    python 30_ci_theater_polyglot_analysis_rust.py
    ```
    This script reads `data/polyglot_rust_repo_summary.csv` (generated by `29_...`) and produces plots and statistics about the co-languages found in polyglot Rust projects.

*   **Test Coverage Analysis**:
    ```bash
    # Example for monoglot cohort
    python 24_2_ci_theater_coverage_rust_analysis.py \
        --input-csv data/24_coverage_monoglot.csv \
        --output-dir figures/coverage_analysis \
        --cohort-name Monoglot
    ```
    This script reads a coverage CSV (e.g., `data/24_coverage_monoglot.csv`) and generates plots visualizing test and coverage adoption for that cohort. It is now integrated into the main workflow.
.

### Utility Modules

*   `bug_issue_utils.py`: A shared module that contains the core logic for fetching and classifying bug-like issues from GitHub repositories. It is used by both `26_ci_bug_issues_count_rust.py` and `31_ci_bug_issues_count.py` to ensure consistent analysis and reduce code duplication.
