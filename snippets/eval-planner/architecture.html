<!DOCTYPE html><html><head>
      <title>architecture</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////home/vishravars/.antigravity/extensions/shd101wyy.markdown-preview-enhanced-0.8.20-universal/crossnote/dependencies/katex/katex.min.css">
      
      
      <script type="text/javascript" src="file:////home/vishravars/.antigravity/extensions/shd101wyy.markdown-preview-enhanced-0.8.20-universal/crossnote/dependencies/mermaid/mermaid.min.js" charset="UTF-8"></script>
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="scalable-agentic-evaluation-system---solution-architecture">Scalable Agentic Evaluation System - Solution Architecture </h1>
<h2 id="1-executive-summary">1. Executive Summary </h2>
<p>This document outlines the solution architecture for a scalable system designed to evaluate Agentic API endpoints. The system is designed to be <strong>deployment-agnostic</strong>, running equally well on public cloud (AWS/GCP/Azure) or on-premise infrastructure (Private Cloud/Bare Metal). It features a pluggable rule interface, scalable execution engine, and comprehensive analytics dashboard.</p>
<h2 id="2-user-personas">2. User Personas </h2>
<p>To clarify system usage and access control, we define the following high-level roles:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Role</th>
<th style="text-align:left">Description</th>
<th style="text-align:left">Responsibilities</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>Platform Admin</strong></td>
<td style="text-align:left">Infrastructure &amp; System Owner</td>
<td style="text-align:left">Manage K8s clusters, DBs, user access, and global quotas. Ensures system uptime.</td>
</tr>
<tr>
<td style="text-align:left"><strong>Eval Engineer</strong></td>
<td style="text-align:left">Primary User / Developer</td>
<td style="text-align:left">Writes Python eval rules, configures test jobs, debugs failures, and uses the SDK.</td>
</tr>
<tr>
<td style="text-align:left"><strong>Product Stakeholder</strong></td>
<td style="text-align:left">Viewer / Analyst</td>
<td style="text-align:left">Views dashboards, checks pass rates, and analyzes aggregated reports. Read-only access.</td>
</tr>
</tbody>
</table>
<h2 id="3-high-level-architecture">3. High-Level Architecture </h2>
<p>The system is divided into three main planes:</p>
<ol>
<li><strong>Control Plane</strong>: Manages users, test configurations, and displays results.</li>
<li><strong>Execution Plane</strong>: Orchestrates and executes the evaluation rules against target agents.</li>
<li><strong>Data Plane</strong>: Stores test results, rule definitions, and execution logs.</li>
</ol>
<h3 id="system-diagram-mermaid">System Diagram (Mermaid) </h3>
<div class="mermaid">graph TD
    User["User / Dev"] --&gt;|Uploads Rules| Dashboard["Dashboard UI"]
    User --&gt;|Configures Test| API["Control Design API"]

    subgraph control_plane["Control Plane"]
        Dashboard --&gt; API
        API --&gt; DB["Primary DB"]
        API --&gt; ObjectStore["Rule Artifacts"]
    end

    subgraph execution_plane["Execution Plane"]
        API --&gt;|Submit Job| Orchestrator["Orchestrator / Queue"]
        Orchestrator --&gt;|Distribute| WorkerPool["Worker Pool (Auto-scaling)"]

        subgraph worker_node["Worker Node"]
            Runner["Test Runner"]
            Sandbox["Rule Sandbox"]
            Runner --&gt;|Loads| Sandbox
            Sandbox --&gt;|Calls| TargetAgent["Target Agentic API"]
        end
    end

    subgraph data_plane["Data Plane"]
        Runner --&gt;|Stream Results| Ingest["Data Ingestion"]
        Ingest --&gt;|Store| AnalyticsDB["Analytics DB"]
        Ingest --&gt;|Logs| LogStore["Logs / Blob Storage"]
    end

    Dashboard --&gt;|Query| AnalyticsDB
</div><h3 id="system-diagram-v2-enhanced">System Diagram v2 (Enhanced) </h3>
<div class="mermaid">graph TD
    User["üë§ Eval Engineer"] --&gt;|1. Upload Rule| Dashboard
    User --&gt;|2. Configure Job| Dashboard
    
    subgraph control["üéõÔ∏è Control Plane"]
        Dashboard["Dashboard UI"]
        API["REST API"]
        DB[("PostgreSQL")]
        ObjectStore[("S3/MinIO")]
        
        Dashboard --&gt; API
        API --&gt; DB
        API --&gt; ObjectStore
    end
    
    subgraph execution["‚öôÔ∏è Execution Plane"]
        Queue["Job Queue"]
        Orchestrator["Orchestrator"]
        Workers["Worker Pool"]
        
        API --&gt;|3. Submit Job| Queue
        Queue --&gt; Orchestrator
        Orchestrator --&gt;|4. Distribute Tasks| Workers
        
        subgraph worker_node["Worker Pod"]
            Runtime["Python Runtime"]
            Sandbox["Rule Sandbox"]
            Runtime --&gt; Sandbox
        end
        
        Workers --&gt; worker_node
        Sandbox --&gt;|5. Invoke| Agent["ü§ñ Target Agentic API"]
        Agent --&gt; Sandbox
    end
    
    subgraph data_plane["üíæ Data Plane"]
        Stream["Stream Processor"]
        Analytics[("ClickHouse/BigQuery")]
        Logs[("S3/MinIO Logs")]
        
        worker_node --&gt;|6. Stream Results| Stream
        Stream --&gt; Analytics
        Stream --&gt; Logs
    end
    
    Dashboard -.-&gt;|7. Query Results| Analytics
    Dashboard -.-&gt; Logs
    
    subgraph security["üîí Security Layer"]
        Vault["HashiCorp Vault"]
        Auth["OIDC/Auth"]
    end
    
    API -.-&gt; Vault
    Dashboard -.-&gt; Auth
    Sandbox -.-&gt; Vault
    
    style control fill:#e1f5ff,stroke:#0277bd,stroke-width:2px
    style execution fill:#fff4e1,stroke:#f57c00,stroke-width:2px
    style data_plane fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    style security fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    style Agent fill:#fff3e0,stroke:#e65100,stroke-width:3px
</div><h3 id="evaluation-flow-sequence-diagram">Evaluation Flow Sequence Diagram </h3>
<div class="mermaid">sequenceDiagram
    actor User as Eval Engineer
    participant Dashboard
    participant API as Control API
    participant DB as PostgreSQL
    participant S3 as Object Store
    participant Queue as Job Queue
    participant Worker
    participant Vault
    participant Agent as Target Agent
    participant Analytics as ClickHouse

    Note over User,Analytics: Phase 1: Rule Upload and Job Configuration
    User-&gt;&gt;Dashboard: Upload evaluation rule (Python)
    Dashboard-&gt;&gt;API: POST /rules
    API-&gt;&gt;S3: Store rule artifact
    API-&gt;&gt;DB: Save rule metadata
    API--&gt;&gt;Dashboard: Rule ID
    
    User-&gt;&gt;Dashboard: Configure test job (target URL, auth, parameters)
    Dashboard-&gt;&gt;API: POST /jobs
    API-&gt;&gt;DB: Persist job configuration
    API-&gt;&gt;Queue: Enqueue evaluation tasks
    API--&gt;&gt;Dashboard: Job ID
    Dashboard--&gt;&gt;User: Job submitted successfully

    Note over Queue,Analytics: Phase 2: Distributed Execution
    Queue-&gt;&gt;Worker: Assign task to available worker
    activate Worker
    Worker-&gt;&gt;S3: Fetch rule code
    Worker-&gt;&gt;Vault: Retrieve target API credentials
    Vault--&gt;&gt;Worker: API key/token
    Worker-&gt;&gt;Worker: Load rule into sandbox
    
    loop For each test case
        Worker-&gt;&gt;Agent: Execute evaluation (with authenticated request)
        Agent--&gt;&gt;Worker: Agent response
        Worker-&gt;&gt;Worker: Compute score and metadata
        Worker-&gt;&gt;Analytics: Stream result (async)
    end
    
    Worker-&gt;&gt;Queue: Mark task complete
    deactivate Worker
    Worker-&gt;&gt;DB: Update job status

    Note over Dashboard,Analytics: Phase 3: Results and Analysis
    Dashboard-&gt;&gt;DB: Poll job status
    DB--&gt;&gt;Dashboard: Status: COMPLETED
    Dashboard-&gt;&gt;Analytics: Query evaluation results
    Analytics--&gt;&gt;Dashboard: Aggregated scores, metrics
    Dashboard--&gt;&gt;User: Display dashboard (charts, pass/fail rates)
    
    opt User wants to debug
        User-&gt;&gt;Dashboard: Click View Logs
        Dashboard-&gt;&gt;S3: Fetch detailed logs
        S3--&gt;&gt;Dashboard: Raw execution traces
        Dashboard--&gt;&gt;User: Show detailed logs
    end
</div><h2 id="3-pluggable-interface-design-the-sdk">3. Pluggable Interface Design (The "SDK") </h2>
<p>To enable flexible and powerful evaluation rules, we define a standard Python SDK that developers use.</p>
<h3 id="base-class-definition">Base Class Definition </h3>
<p>Evaluators implement a standard interface. This allows the system to load and execute them blindly.</p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code><span class="token keyword keyword-from">from</span> abc <span class="token keyword keyword-import">import</span> ABC<span class="token punctuation">,</span> abstractmethod
<span class="token keyword keyword-from">from</span> typing <span class="token keyword keyword-import">import</span> Dict<span class="token punctuation">,</span> Any

<span class="token keyword keyword-class">class</span> <span class="token class-name">EvaluationContext</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Provides context like unique run_id, logger, and client for target agent."""</span>
    run_id<span class="token punctuation">:</span> <span class="token builtin">str</span>
    target_url<span class="token punctuation">:</span> <span class="token builtin">str</span>
    config<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span>

    <span class="token keyword keyword-def">def</span> <span class="token function">call_agent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> prompt<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Helper to safely call the target agent API."""</span>
        <span class="token keyword keyword-pass">pass</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">BaseEvalRule</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""The contract for all evaluation rules."""</span>
    
    <span class="token decorator annotation punctuation">@property</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword keyword-def">def</span> <span class="token function">name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Unique name of the evaluation rule."""</span>
        <span class="token keyword keyword-pass">pass</span>

    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword keyword-def">def</span> <span class="token function">evaluate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ctx<span class="token punctuation">:</span> EvaluationContext<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Execute the evaluation logic.
        Returns: Dict containing 'score', 'passed' (bool), and 'metadata'.
        """</span>
        <span class="token keyword keyword-pass">pass</span>
</code></pre><h3 id="anatomy-of-an-evaluation-rule">Anatomy of an Evaluation Rule </h3>
<p>The following diagram depicts the necessary elements that constitute a custom evaluation rule:</p>
<div class="mermaid">graph LR
    subgraph Inputs ["1. Inputs (Context)"]
        direction TB
        Config["config (Dict)"]
        RunID["run_id (str)"]
        AgentCall["call_agent (method)"]
    end

    subgraph Logic ["2. Core Logic"]
        direction TB
        Eval["evaluate(ctx)"]
    end

    subgraph Outputs ["3. Outputs (Result)"]
        direction TB
        Score["score (float)"]
        Passed["passed (bool)"]
        Metadata["metadata (Dict)"]
    end

    Inputs ==&gt; Logic
    Logic ==&gt; Outputs
    
    style Logic fill:#f9f,stroke:#333,stroke-width:2px
    style Outputs fill:#dfd,stroke:#333,stroke-width:2px
</div><p><strong>Rule Anatomy Elements:</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">Section</th>
<th style="text-align:left">Element</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>1. Inputs</strong></td>
<td style="text-align:left"><code>config</code></td>
<td style="text-align:left"><code>Dict</code></td>
<td style="text-align:left">Configuration parameters for the specific evaluation rule (e.g., thresholds, prompts).</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"><code>run_id</code></td>
<td style="text-align:left"><code>str</code></td>
<td style="text-align:left">A unique identifier for the current evaluation run, used for logging and correlation.</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"><code>call_agent</code></td>
<td style="text-align:left"><code>method</code></td>
<td style="text-align:left">A helper method to securely invoke the target agentic API.</td>
</tr>
<tr>
<td style="text-align:left"><strong>2. Logic</strong></td>
<td style="text-align:left"><code>evaluate(ctx)</code></td>
<td style="text-align:left"><code>method</code></td>
<td style="text-align:left">The core function where the developer implements the evaluation logic using the context provided.</td>
</tr>
<tr>
<td style="text-align:left"><strong>3. Outputs</strong></td>
<td style="text-align:left"><code>score</code></td>
<td style="text-align:left"><code>float</code></td>
<td style="text-align:left">A numerical score (typically 0-100) representing the quality of the agent's response.</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"><code>passed</code></td>
<td style="text-align:left"><code>bool</code></td>
<td style="text-align:left">A binary status indicating whether the agent met the evaluation criteria.</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"><code>metadata</code></td>
<td style="text-align:left"><code>Dict</code></td>
<td style="text-align:left">Rich contextual data for analytics, debugging, and dashboard visualization.</td>
</tr>
</tbody>
</table>
<h3 id="conceptual-model">Conceptual Model </h3>
<p>This diagram shows how the core objects integrate during a single evaluation run.</p>
<div class="mermaid">graph LR
    Rule[Custom Eval Rule] --&gt;|uses| Ctx[Evaluation Context]
    Ctx --&gt;|calls| Agent[Target Agent]
    Agent --&gt;|returns response| Ctx
    Rule --&gt;|returns| Result[Eval Result]
    
    style Rule fill:#f9f,stroke:#333,stroke-width:2px
    style Result fill:#dfd,stroke:#333,stroke-width:2px
</div><p><strong>Core Terms:</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">Term</th>
<th style="text-align:left">Role</th>
<th style="text-align:left">Responsibility</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>Custom Eval Rule</strong></td>
<td style="text-align:left">Logic</td>
<td style="text-align:left">Developer-defined code that implements the evaluation logic.</td>
</tr>
<tr>
<td style="text-align:left"><strong>Evaluation Context</strong></td>
<td style="text-align:left">Bridge</td>
<td style="text-align:left">Provides the rule with configuration and a secure way to call the agent.</td>
</tr>
<tr>
<td style="text-align:left"><strong>Target Agent</strong></td>
<td style="text-align:left">Subject</td>
<td style="text-align:left">The external system or API being evaluated.</td>
</tr>
<tr>
<td style="text-align:left"><strong>Eval Result</strong></td>
<td style="text-align:left">Output</td>
<td style="text-align:left">The standardized output containing the <code>score</code> and <code>passed</code> status.</td>
</tr>
</tbody>
</table>
<h3 id="32-target-authentication">3.2. Target Authentication </h3>
<p>The system supports multiple authentication standards to connect to the target Agentic APIs. Credentials are strictly separated from rule code.</p>
<p><strong>Supported Schemes:</strong></p>
<ol>
<li><strong>API Key</strong>: Injected as a custom header (e.g., <code>x-api-key</code>, <code>Authorization</code>) or query parameter.</li>
<li><strong>Bearer Token</strong>: Standard OAuth2/JWT tokens (<code>Authorization: Bearer &lt;token&gt;</code>).</li>
<li><strong>Basic Auth</strong>: Standard username/password scheme.</li>
<li><strong>mTLS</strong>: Client certificates for highly secure internal environments.</li>
</ol>
<p><strong>Mechanism:</strong></p>
<ul>
<li><strong>Configuration</strong>: Admins configure "Secrets" per Project/Target in the Dashboard.</li>
<li><strong>Injection</strong>: The <code>EvaluationContext</code> is hydrated with an authenticated HTTP client, or secrets are injected as environment variables (<code>TARGET_API_KEY</code>) into the sandbox for the rule to use explicitly.</li>
<li><strong>Security</strong>: Secrets are stored in HashiCorp Vault or K8s Secrets, never in plain text in the DB.</li>
</ul>
<h3 id="33-rule-authoring--editing">3.3. Rule Authoring &amp; Editing </h3>
<ul>
<li><strong>Code-First</strong>: Developers use the SDK to write rules in their IDE and push to git/storage.</li>
<li><strong>Dashboard Editor</strong>: authenticated users with <code>EDITOR</code> or <code>ADMIN</code> roles can edit rule code directly in the Dashboard.
<ul>
<li><em>Mechanism</em>: The Dashboard fetches the rule content from the API, user edits in Monaco Editor (VS Code web), and saves. The API versions the rule and updates the Object Store.</li>
<li><em>Security</em>: Strict RBAC checks ensure only authorized personnel can modify production rules.</li>
</ul>
</li>
</ul>
<h2 id="4-component-details">4. Component Details </h2>
<h3 id="41-orchestrator--scaling">4.1. Orchestrator &amp; Scaling </h3>
<ul>
<li><strong>Choice</strong>: Kubernetes + Celery/Redis OR <a href="http://Temporal.io">Temporal.io</a>.</li>
<li><strong>Reasoning</strong>: Temporal provides excellent handling of long-running evaluations (conversations) and reliable retries. Kubernetes HPA (Horizontal Pod Autoscaler) scales the Worker Pool based on queue depth.</li>
</ul>
<h3 id="42-storage-strategy">4.2. Storage Strategy </h3>
<ul>
<li><strong>Primary DB (Postgres)</strong>: Stores Users, Projects, Rule Metadata, Job Configurations. Portable and standard.</li>
<li><strong>Analytics DB (ClickHouse)</strong>: Stores the raw evaluation results.
<ul>
<li><em>Cloud Mode</em>: Managed ClickHouse or BigQuery.</li>
<li><em>On-Prem Mode</em>: Self-hosted ClickHouse or TimescaleDB.</li>
</ul>
</li>
<li><strong>Object Storage</strong>: Stores the actual rule code artifacts and full raw logs/traces.
<ul>
<li><em>Cloud Mode</em>: AWS S3, GCS, Azure Blob.</li>
<li><em>On-Prem Mode</em>: <strong>MinIO</strong> or Ceph (S3-compatible API).</li>
</ul>
</li>
</ul>
<h3 id="43-dashboard">4.3. Dashboard </h3>
<ul>
<li><strong>Tech</strong>: React/Next.js + Recharts/D3.</li>
<li><strong>Features</strong>:
<ul>
<li><strong>Rule Editor</strong>: Full Monaco-based code editor with syntax highlighting for on-the-fly rule modifications (guarded by RBAC).</li>
<li><strong>Job Monitor</strong>: Real-time progress of running evals.</li>
<li><strong>Analytics</strong>: Charts showing pass rates, latency distributions, and cost tracking.</li>
</ul>
</li>
</ul>
<h2 id="5-deployment--security">5. Deployment &amp; Security </h2>
<ul>
<li><strong>Deployment Environments</strong>:
<ul>
<li><strong>Cloud</strong>: Managed Kubernetes (EKS/GKE), DBaaS (RDS, Big Query).</li>
<li><strong>On-Premise</strong>:
<ul>
<li>Orchestration: Self-managed Kubernetes (Rancher, OpenShift) or pure Docker Swarm for smaller setups.</li>
<li>Storage: MinIO (Object Store), PostgreSQL (Meta), ClickHouse (Analytics) deployed as StatefulSets or external clusters.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Isolation</strong>:
<ul>
<li>Evaluation code runs in isolated containers.</li>
<li><em>Security</em>: Use <strong>gVisor</strong> or <strong>Kata Containers</strong> runtime classes in K8s for hard isolation on-premise where users might not control the hypervisor.</li>
</ul>
</li>
<li><strong>Auth</strong>:
<ul>
<li>OIDC/OAuth2 integration (Keycloak for on-prem, Auth0/Cognito for cloud) for User Management.</li>
<li>Vault (HashiCorp) for secret management in both environments.</li>
</ul>
</li>
</ul>
<h2 id="6-implementation-steps">6. Implementation Steps </h2>
<ol>
<li><strong>Define SDK</strong>: Publish <code>agent-eval-sdk</code> pypi package.</li>
<li><strong>Build Worker</strong>: Create the container capable of dynamic loading.</li>
<li><strong>Setup Infra</strong>: Deploy K8s cluster and Databases.</li>
<li><strong>Dev API</strong>: Build the control plane API.</li>
</ol>

      </div>
      
      
    
    
    <script type="module">
// TODO: If ZenUML gets integrated into mermaid in the future,
//      we can remove the following lines.


var MERMAID_CONFIG = ({"startOnLoad":false});
if (typeof MERMAID_CONFIG !== 'undefined') {
  MERMAID_CONFIG.startOnLoad = false
  MERMAID_CONFIG.cloneCssStyles = false
  MERMAID_CONFIG.theme = "default"
}

mermaid.initialize(MERMAID_CONFIG || {})
if (typeof(window['Reveal']) !== 'undefined') {
  function mermaidRevealHelper(event) {
    var currentSlide = event.currentSlide
    var diagrams = currentSlide.querySelectorAll('.mermaid')
    for (var i = 0; i < diagrams.length; i++) {
      var diagram = diagrams[i]
      if (!diagram.hasAttribute('data-processed')) {
        mermaid.init(null, diagram, ()=> {
          Reveal.slide(event.indexh, event.indexv)
        })
      }
    }
  }
  Reveal.addEventListener('slidetransitionend', mermaidRevealHelper)
  Reveal.addEventListener('ready', mermaidRevealHelper)
  await mermaid.run({
    nodes: document.querySelectorAll('.mermaid')
  })
} else {
  await mermaid.run({
    nodes: document.querySelectorAll('.mermaid')
  })
}
</script>
    
    
    
  
    </body></html>